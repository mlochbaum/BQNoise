# Standard oscillators for (usually subtractive) synthesis
# In each case, the right argument argument is a list giving the
# frequency for each sample.
# If not otherwise specified, the left argument is optional and gives
# the phase offset.

"oscillator.bqn takes a single option namespace, or no arguments" ! 1â‰¥â‰ â€¢args
o â† â‰ â—¶âŸ¨â€¢Importâˆ˜"options.bqn", âŠ‘âŸ© â€¢args

# Utilities
Ce â† 1-Ëœ2âŠ¸Ã—                   # Center: transform [0,1] to [Â¯1,1]
Rand â† Ce {o.RandFloats ğ•©}

# Basic waveforms
Id â† {ğ•¨++`ğ•©Ã·o.freq}           # Identity
P â† 1|Id                      # Phase

# Deterministic waveforms for synthesis
Saw   â‡ Ceâˆ˜P                  # Sawtooth wave //////
Triangle â‡ Ceâˆ˜| {ğ•¨+0.25}SawâŠ¢  # Triangle wave Â´\/\/\
Squareâ‡ Ce 0.5<P              # Square wave   âŠ”Â¯âŠ”Â¯âŠ”Â¯
Pulse â‡ Ce <âŸœP                # Pulse wave with duty cycle ğ•¨
Sine  â‡ â€¢math.Sin (2Ã—Ï€) Ã— Id  # Sine wave

# Random waveforms
White â‡ Rand â‰¢                # White noise
Brown â‡ +` White              # Brown noise
# Pink noise
#Pink  â‡ Ã·âŸœ(âŒˆÂ´|) (2âŠ¸/âŠ¸+ËœÂ´âˆ˜âŒ½ Â· RandÂ¨ 2â‹†â†•)âŠ¸Ã·âˆ˜(1+Â·âŒˆ2â‹†â¼âŠ¢)âŠ¸(â†‘Ëœ)âˆ˜â‰ 
Pink  â‡ Ã·âŸœ(âŒˆÂ´|) (+` Â·â¥Šâˆ˜â‰âˆ˜â‰Â´ Â·-âŸœÂ«âˆ˜RandÂ¨ 2â‹†1âŒˆâŒ½âˆ˜â†•)âˆ˜(1+Â·âŒˆ2â‹†â¼âŠ¢)âŠ¸(â†‘Ëœ)âˆ˜â‰ 

# Karplus-Stong algorithm for a plucked string
Pluck â‡ { ğ•Š fâ€¿lenâ€¿att: # Frequency, length, attenuation
  p â† âŒŠo.freqÃ·f
  âˆ¾ ((Ã·2Ã—16â‹†attÃ·p)Ã—1âŠ¸âŒ½âŠ¸+)âŸ(â†•âŒˆlenÃ·p) Pink pâ¥Š0
}
